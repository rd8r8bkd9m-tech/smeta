<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>–°–º–µ—Ç–∞ - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–º–µ—Ç</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–º–µ—Ç —Å –ò–ò –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ—á–Ω—ã–µ —Å–º–µ—Ç—ã –±—ã—Å—Ç—Ä–æ –∏ –ª–µ–≥–∫–æ.">
    <meta name="keywords" content="—Å–º–µ—Ç–∞, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–µ–º–æ–Ω—Ç, –ò–ò, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, —Ä–∞—Å—á–µ—Ç">
    <meta name="author" content="rd8r8bkd9m-tech">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="–°–º–µ—Ç–∞">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–°–º–µ—Ç–∞">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512x512.png">
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="icons/icon-512x512.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72x72.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-72x72.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        <span class="theme-icon">üåô</span>
    </button>
    
    <div class="container">
        <header>
            <h1>üìã –°–º–µ—Ç–∞</h1>
            <p class="subtitle">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–º–µ—Ç</p>
        </header>

        <main id="app">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view">
                <div class="dashboard-header">
                    <h2>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                    <button id="closeDashboardBtn" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-value" id="statTotalEstimates">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Å–º–µ—Ç</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="statTotalValue">0 ‚ÇΩ</div>
                        <div class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value" id="statAvgValue">0 ‚ÇΩ</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-value" id="statThisMonth">0</div>
                        <div class="stat-label">–ó–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</div>
                    </div>
                </div>
            </div>

            <!-- Templates View -->
            <div id="templatesView" class="view">
                <div class="toolbar">
                    <button id="closeTemplatesBtn" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
                    <button id="saveTemplateBtn" class="btn btn-success" style="display: none;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω</button>
                </div>
                
                <h2>üìë –®–∞–±–ª–æ–Ω—ã —Å–º–µ—Ç</h2>
                <div id="templatesList" class="templates-grid">
                    <!-- Templates will be rendered here -->
                </div>
            </div>

            <!-- List View -->
            <div id="listView" class="view active">
                <div class="toolbar toolbar-extended">
                    <div class="toolbar-row">
                        <button id="showDashboardBtn" class="btn btn-primary">
                            üìä –î–∞—à–±–æ—Ä–¥
                        </button>
                        <button id="showTemplatesBtn" class="btn btn-secondary">
                            üìë –®–∞–±–ª–æ–Ω—ã
                        </button>
                        <button id="selectAllBtn" class="btn" title="–í—ã–±—Ä–∞—Ç—å –≤—Å–µ">
                            ‚òëÔ∏è –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
                        </button>
                        <button id="bulkDeleteBtn" class="btn btn-danger" disabled title="–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å (<span id="selectedCount">0</span>)
                        </button>
                        <button id="compareEstimatesBtn" class="btn" disabled>
                            üîç –°—Ä–∞–≤–Ω–∏—Ç—å (–º–∏–Ω. 2)
                        </button>
                        </button>
                        <button id="createWithAiBtn" class="btn btn-primary">
                            ü§ñ –°–æ–∑–¥–∞—Ç—å —Å –ò–ò
                        </button>
                        <button id="createManualBtn" class="btn btn-secondary">
                            ‚ûï –°–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é
                        </button>
                    </div>
                    
                    <div class="toolbar-row search-filter-row">
                        <input type="text" id="searchInput" class="form-control search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–ª–∏–µ–Ω—Ç—É, –ø—Ä–æ–µ–∫—Ç—É...">
                        <select id="sortBySelect" class="form-control">
                            <option value="date">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –¥–∞—Ç–µ</option>
                            <option value="name">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                            <option value="total">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏</option>
                        </select>
                        <select id="sortOrderSelect" class="form-control">
                            <option value="desc">‚Üì –ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                            <option value="asc">‚Üë –ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                        </select>
                    </div>
                </div>
                
                <div id="estimatesList" class="estimates-list">
                    <div class="empty-state">
                        <p>üìÑ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–º–µ—Ç</p>
                        <p class="help-text">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ò–ò –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é</p>
                    </div>
                </div>
            </div>

            <!-- AI Generation View -->
            <div id="aiView" class="view">
                <div class="toolbar">
                    <button id="backFromAiBtn" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
                </div>

                <div class="ai-form">
                    <div class="ai-header">
                        <h2>ü§ñ –ò–ò –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–º–µ—Ç</h2>
                        <p class="ai-description">–û–ø–∏—à–∏—Ç–µ —Ä–∞–±–æ—Ç—ã –∏ –æ–±—ä–µ–∫—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è. –ù–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç–∏—Ç—É—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ —Å–æ–∑–¥–∞—Å—Ç —Å–º–µ—Ç—É —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 99%</p>
                        
                        <div class="specialists-info">
                            <p><strong>–ö–æ–º–∞–Ω–¥–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:</strong></p>
                            <ul class="specialists-list">
                                <li>üèóÔ∏è –ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä - –∞–Ω–∞–ª–∏–∑ –æ–±—ä–µ–∫—Ç–∞</li>
                                <li>üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä - —Ä–∞—Å—á–µ—Ç –æ–±—ä–µ–º–æ–≤</li>
                                <li>üî® –ü—Ä–æ—Ä–∞–± - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç</li>
                                <li>üì¶ –°–Ω–∞–±–∂–µ–Ω–µ—Ü - –ø–æ–¥–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</li>
                                <li>üí∞ –°–º–µ—Ç—á–∏–∫ - –∏—Ç–æ–≥–æ–≤–∞—è —Å–º–µ—Ç–∞</li>
                            </ul>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="aiApiKey">API –∫–ª—é—á Gemini:</label>
                        <input type="password" id="aiApiKey" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á Google Gemini">
                        <small class="help-text">–ü–æ–ª—É—á–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∞ <a href="https://makersuite.google.com/app/apikey" target="_blank">makersuite.google.com</a></small>
                        <small class="help-text" style="display: block; margin-top: 5px; color: #8b5cf6;">
                            ‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å: Gemini 1.5 Flash (–±—ã—Å—Ç—Ä–∞—è –∏ —Ç–æ—á–Ω–∞—è)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="aiDescription">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∏ —Ä–∞–±–æ—Ç:</label>
                        <textarea id="aiDescription" class="form-control" rows="6" placeholder="–ü—Ä–∏–º–µ—Ä: –†–µ–º–æ–Ω—Ç 2-–∫–æ–º–Ω–∞—Ç–Ω–æ–π –∫–≤–∞—Ä—Ç–∏—Ä—ã 52 –∫–≤.–º., –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã—Ä–æ–≤–Ω—è—Ç—å —Å—Ç–µ–Ω—ã —à—Ç—É–∫–∞—Ç—É—Ä–∫–æ–π, –ø–æ–∫—Ä–∞—Å–∏—Ç—å —Å—Ç–µ–Ω—ã –∏ –ø–æ—Ç–æ–ª–∫–∏, —É–ª–æ–∂–∏—Ç—å –ª–∞–º–∏–Ω–∞—Ç –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö –∏ –ø–ª–∏—Ç–∫—É –≤ –≤–∞–Ω–Ω–æ–π"></textarea>
                    </div>

                    <div class="ai-controls">
                        <button id="generateEstimateBtn" class="btn btn-success btn-large">
                            ‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–º–µ—Ç—É
                        </button>
                    </div>

                    <div id="aiStatus" class="ai-status" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p class="status-text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–º–µ—Ç—ã...</p>
                    </div>

                    <div id="aiResult" class="ai-result" style="display: none;">
                        <h3>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–º–µ—Ç–∞</h3>
                        <div id="aiResultContent"></div>
                        <div class="ai-actions">
                            <button id="acceptAiBtn" class="btn btn-success">‚úì –ü—Ä–∏–Ω—è—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button id="regenerateBtn" class="btn btn-secondary">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit View -->
            <div id="editView" class="view">
                <div class="toolbar toolbar-extended">
                    <div class="toolbar-row">
                        <button id="backToListBtn" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
                        <button id="undoBtn" class="btn" disabled title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)">‚Ü∂ –û—Ç–º–µ–Ω–∏—Ç—å</button>
                        <button id="redoBtn" class="btn" disabled title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Y)">‚Ü∑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                        <button id="saveEstimateBtn" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button id="saveAsTemplateBtn" class="btn">üìë –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω</button>
                    </div>
                    <div class="toolbar-row">
                        <button id="exportBtn" class="btn">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                        <button id="exportExcelBtn" class="btn">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                        <button id="exportJsonBtn" class="btn">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                        <button id="duplicateEstimateBtn" class="btn">üìã –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>

                <div class="estimate-form">
                    <div class="form-header">
                        <div class="form-group">
                            <label for="estimateTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–º–µ—Ç—ã:</label>
                            <input type="text" id="estimateTitle" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–º–µ—Ç—ã">
                        </div>
                        <div class="form-group">
                            <label for="estimateDate">–î–∞—Ç–∞:</label>
                            <input type="date" id="estimateDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="estimateClient">–ö–ª–∏–µ–Ω—Ç:</label>
                            <input type="text" id="estimateClient" class="form-control" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                        </div>
                        <div class="form-group">
                            <label for="estimateProject">–ü—Ä–æ–µ–∫—Ç:</label>
                            <input type="text" id="estimateProject" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞">
                        </div>
                    </div>

                    <div class="line-items">
                        <h3>–ü–æ–∑–∏—Ü–∏–∏ —Å–º–µ—Ç—ã</h3>
                        <button id="addItemBtn" class="btn btn-secondary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
                        
                        <div id="itemsContainer" class="items-container">
                            <!-- Items will be added dynamically -->
                        </div>
                    </div>

                    <div class="totals">
                        <div class="total-row">
                            <span class="total-label">–ò—Ç–æ–≥–æ:</span>
                            <span id="totalAmount" class="total-amount">0.00 ‚ÇΩ</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>¬© 2025 –°–º–µ—Ç–∞ - –ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–º–µ—Ç</p>
            <button id="keyboardShortcutsBtn" class="shortcuts-help-btn" title="–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ (?)">‚å®Ô∏è</button>
        </footer>
    </div>

    <script src="app.js"></script>
    
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt" style="display: none;">
        <div class="install-prompt-content">
            <button id="installClose" class="install-close">‚úï</button>
            <div class="install-icon">üì±</div>
            <h3>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
            <p>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –°–º–µ—Ç–∞ –Ω–∞ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
            <button id="installButton" class="btn btn-primary btn-large">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="shortcuts-modal" style="display: none;">
        <div class="shortcuts-modal-content">
            <button id="shortcutsClose" class="shortcuts-close">‚úï</button>
            <h2>‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h2>
            <div class="shortcuts-list">
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>N</kbd></span>
                    <span class="shortcut-desc">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–º–µ—Ç—É</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>K</kbd></span>
                    <span class="shortcut-desc">–°–æ–∑–¥–∞—Ç—å —Å–º–µ—Ç—É —Å –ò–ò</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>S</kbd></span>
                    <span class="shortcut-desc">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–º–µ—Ç—É</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Z</kbd></span>
                    <span class="shortcut-desc">–û—Ç–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Y</kbd></span>
                    <span class="shortcut-desc">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>P</kbd></span>
                    <span class="shortcut-desc">–ü–µ—á–∞—Ç—å/–≠–∫—Å–ø–æ—Ä—Ç</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>F</kbd></span>
                    <span class="shortcut-desc">–ü–æ–∏—Å–∫</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>D</kbd></span>
                    <span class="shortcut-desc">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>Esc</kbd></span>
                    <span class="shortcut-desc">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-keys"><kbd>?</kbd></span>
                    <span class="shortcut-desc">–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ –æ–∫–Ω–æ</span>
                </div>
            </div>
            <p class="shortcuts-note">üí° –ù–∞ Mac –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <kbd>Cmd</kbd> –≤–º–µ—Å—Ç–æ <kbd>Ctrl</kbd></p>
        </div>
    </div>
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úì Service Worker registered:', registration.scope);
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Check every minute
                    })
                    .catch(error => {
                        console.log('‚úó Service Worker registration failed:', error);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installButton = document.getElementById('installButton');
        const installClose = document.getElementById('installClose');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install prompt after 3 seconds
            setTimeout(() => {
                if (!localStorage.getItem('installPromptDismissed')) {
                    installPrompt.style.display = 'flex';
                }
            }, 3000);
        });
        
        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
                return;
            }
            
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);
            
            // Clear the deferredPrompt
            deferredPrompt = null;
            installPrompt.style.display = 'none';
        });
        
        installClose.addEventListener('click', () => {
            installPrompt.style.display = 'none';
            localStorage.setItem('installPromptDismissed', 'true');
        });
        
        // Detect if app is running as standalone (installed)
        window.addEventListener('DOMContentLoaded', () => {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches 
                || window.navigator.standalone 
                || document.referrer.includes('android-app://');
            
            if (isStandalone) {
                console.log('‚úì Running as installed PWA');
                document.body.classList.add('standalone');
            }
        });
        
        // Handle URL parameters for shortcuts
        const urlParams = new URLSearchParams(window.location.search);
        const action = urlParams.get('action');
        
        window.addEventListener('DOMContentLoaded', () => {
            if (action === 'new') {
                // Trigger manual estimate creation
                document.getElementById('createManualBtn')?.click();
            } else if (action === 'ai') {
                // Trigger AI estimate creation
                document.getElementById('createWithAiBtn')?.click();
            }
        });
    </script>
</body>
</html>
